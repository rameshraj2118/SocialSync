<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SocialSync Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='home.css') }}">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- NAVBAR / HEADER -->
  <header class="top-nav">
    <div class="nav-left">
      <!-- Logo inside navbar -->
      <div class="logo">
        <img src="static/images/logo.png" alt="SocialSync Logo">
      </div>
      <ul class="menu">
        <li class="menu-list">Home</li>
        <li class="menu-list">Explore</li>
        <li class="menu-list">Live</li>
        <li class="menu-list">Trends</li>
        <li class="menu-list">Notifications</li>
        <img class="avatar" src="static/images/pfp.jpg" alt="img">
      </ul>
    </div>
  </header>

  <!-- MAIN LAYOUT -->
  <div class="layout">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div>
        <div class="user-info">
          <p class="username">{{ session.username }}</p>
          <p class="handle">@{{ session.handle }}</p>
        </div>
        <nav>
          <ul>
            <a href="{{ url_for('home') }}"><li class="active"><i class="fa-solid fa-chart-simple"></i> Analytics</li></a>
            <a href="{{ url_for('post') }}"><li><i class="fa-solid fa-plus"></i>Posts</li></a>
            <a href="{{ url_for('schedule') }}"><li><i class="fa-solid fa-calendar-days"></i> Schedule</li></a>
            <a href="{{ url_for('home') }}"><li><i class="fa-solid fa-gear"></i> Settings</li></a>
          </ul>
        </nav>
      </div>
      <a href="{{ url_for('login') }}"><button class="logout-btn">Log Out</button></a>
    </aside>

    <!-- CONTENT -->
    <main class="main">
      <section class="content">
        <h1 class="aly">Analytics</h1>
        <p class="subtext">This is your dashboard for the last 30 days.</p>
        <div class="tabs">
          <a href="{{ url_for('home') }}"><button>Instagram</button></a>
          <a href="{{ url_for('youtube') }}"><button class="active">YouTube</button></a>
          <a href="{{ url_for('facebook') }}"><button>Facebook</button></a>
          <a href="{{ url_for('twitter') }}"><button>Twitter</button></a>
        </div>

        <div class="stats-grid">
          <div class="stat-box">
            <p>Subscribers</p>
            <h2>
              <span id="yt-subs">0</span>
              <span id="yt-subs-change">0</span>
            </h2>
          </div>

          <div class="stat-box">
            <p>Views</p>
            <h2>
              <span id="yt-views">0</span>
              <span id="yt-views-change">0</span>
            </h2>
          </div>

          <div class="stat-box">
            <p>Engagement Rate</p>
            <h2>
              <span id="yt-engagement">0</span>%
              <span id="yt-engagement-change">0%</span>
            </h2>
          </div>

          <div class="stat-box">
            <p>Likes</p>
            <h2>
              <span id="yt-likes">0</span>
              <span id="yt-likes-change">0</span>
            </h2>
          </div>
        </div>

        <div class="charts-grid">
          <div class="chart-box">
            <p>Views</p>
            <canvas id="ytViewsChart"></canvas>
          </div>

          <div class="chart-box">
            <p>Subscribers Growth</p>
            <canvas id="ytSubsChart"></canvas>
          </div>
        </div>
      </section>
    </main>
  </div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
let subsChart = null;
let viewsChart = null;

async function loadYouTubeData() {
  const res = await fetch("/api/youtube");
  const data = await res.json();

  updateBox("yt-subs","yt-subs-change",data.subscribers,data.subscribers_change);
  updateBox("yt-views","yt-views-change",data.views,data.views_change);
  updateBox("yt-engagement","yt-engagement-change",data.engagement_rate,data.engagement_change,"%");
  updateBox("yt-likes","yt-likes-change",data.likes,data.likes_change);

  subsChart = createChart("ytSubsChart", data.labels, data.subscribers_graph, subsChart);
  viewsChart = createChart("ytViewsChart", data.labels, data.views_graph, viewsChart);
}

function updateBox(valueId, changeId, value, change, suffix="") {
  document.getElementById(valueId).innerText = value;

  const el = document.getElementById(changeId);
  el.innerText = (change >= 0 ? "+" : "") + change + suffix;

  el.classList.remove("positive","negative");
  el.classList.add(change >= 0 ? "positive" : "negative");
}

function createChart(id, labels, values, existing) {
  if (existing) existing.destroy();

  const ctx = document.getElementById(id).getContext("2d");

  const gradient = ctx.createLinearGradient(0,0,0,300);
  gradient.addColorStop(0,"rgba(239,68,68,0.4)");
  gradient.addColorStop(1,"rgba(239,68,68,0)");

  return new Chart(ctx,{
    type:"line",
    data:{
      labels:labels,
      datasets:[{
        data:values,
        borderColor:"#ef4444",
        backgroundColor:gradient,
        fill:true,
        tension:0.4,
        borderWidth:3
      }]
    },
    options:{
      plugins:{legend:{display:false}},
      scales:{
        x:{grid:{display:false}},
        y:{grid:{color:"rgba(255,255,255,0.05)"}}
      }
    }
  });
}

loadYouTubeData();
setInterval(loadYouTubeData,10000);
</script>
</body>
</html>
