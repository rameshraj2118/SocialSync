<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SocialSync Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='home.css') }}">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- NAVBAR / HEADER -->
  <header class="top-nav">
    <div class="nav-left">
      <!-- Logo inside navbar -->
      <div class="logo">
        <img src="static/images/logo.png" alt="SocialSync Logo">
      </div>
      <ul class="menu">
        <li class="menu-list">Home</li>
        <li class="menu-list">Explore</li>
        <li class="menu-list">Live</li>
        <li class="menu-list">Trends</li>
        <li class="menu-list">Notifications</li>
        <img class="avatar" src="static/images/pfp.jpg" alt="img">
      </ul>
    </div>
  </header>

  <!-- MAIN LAYOUT -->
  <div class="layout">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div>
        <div class="user-info">
          <p class="username">{{ session.username }}</p>
          <p class="handle">@{{ session.handle }}</p>
        </div>
        <nav>
          <ul>
            <a href="{{ url_for('home') }}"><li class="active"><i class="fa-solid fa-chart-simple"></i> Analytics</li></a>
            <a href="{{ url_for('post') }}"><li><i class="fa-solid fa-plus"></i>Posts</li></a>
            <a href="{{ url_for('schedule') }}"><li><i class="fa-solid fa-calendar-days"></i> Schedule</li></a>
            <a href="{{ url_for('ads') }}"><li><i class="fa-solid fa-bullhorn"></i> Ads</li></a>
            <a href="{{ url_for('inbox') }}"><li><i class="fa-regular fa-comment-dots"></i> Inbox</li></a>
            <a href="{{ url_for('settings') }}"><li><i class="fa-solid fa-gear"></i> Settings</li></a>
          </ul>
        </nav>
      </div>
      <a href="{{ url_for('login') }}"><button class="logout-btn">Log Out</button></a>
    </aside>

    <!-- CONTENT -->
    <main class="main">
      <section class="content">
        <h1 class="aly">Analytics</h1>
        <p class="subtext">This is your dashboard for the last 30 days.</p>

        <div class="tabs">
          <a href="{{ url_for('home') }}"><button>Instagram</button></a>
          <a href="{{ url_for('youtube') }}"><button>YouTube</button></a>
          <a href="{{ url_for('facebook') }}"><button>Facebook</button></a>
          <a href="{{ url_for('twitter') }}"><button class="active">Twitter</button></a>
        </div>

       <div class="stats-grid">

      <div class="stat-box">
          <p>Followers</p>
          <h2>
            <span id="tw-followers">0</span>
            <span id="tw-followers-change">0</span>
          </h2>
        </div>

        <div class="stat-box">
          <p>Impressions</p>
          <h2>
            <span id="tw-impressions">0</span>
            <span id="tw-impressions-change">0</span>
          </h2>
        </div>

        <div class="stat-box">
          <p>Engagement Rate</p>
          <h2>
            <span id="tw-engagement">0</span>%
            <span id="tw-engagement-change">0%</span>
          </h2>
        </div>

        <div class="stat-box">
          <p>Likes</p>
          <h2>
            <span id="tw-likes">0</span>
            <span id="tw-likes-change">0</span>
          </h2>
        </div>
      </div>

        <div class="charts-grid">
          <div class="chart-box">
            <p>Impressions</p>
            <canvas id="twImpressionsChart"></canvas>
          </div>
          <div class="chart-box">
            <p>Followers Growth</p>
            <canvas id="twFollowersChart"></canvas>
          </div>
        </div>
        </div>
      </section>
    </main>
  </div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
let twFollowersChart = null;
let twImpressionsChart = null;

// ================= LOAD TWITTER DATA =================
async function loadTwitterData() {
  const res = await fetch("/api/twitter");
  const data = await res.json();

  updateBox("tw-followers","tw-followers-change",data.followers,data.followers_change);
  updateBox("tw-impressions","tw-impressions-change",data.impressions,data.impressions_change);
  updateBox("tw-engagement","tw-engagement-change",data.engagement_rate,data.engagement_change,"%");
  updateBox("tw-likes","tw-likes-change",data.likes,data.likes_change);

  twFollowersChart = createChart(
    "twFollowersChart",
    data.labels,
    data.followers_graph,
    twFollowersChart
  );

  twImpressionsChart = createChart(
    "twImpressionsChart",
    data.labels,
    data.impressions_graph,
    twImpressionsChart
  );
}

// ================= UPDATE BOX =================
function updateBox(valueId, changeId, value, change, suffix="") {
  document.getElementById(valueId).innerText = value;

  const el = document.getElementById(changeId);
  el.innerText = (change >= 0 ? "+" : "") + change + suffix;

  el.classList.remove("positive","negative");
  el.classList.add(change >= 0 ? "positive" : "negative");
}

// ================= TWITTER CHART STYLE =================
function createChart(id, labels, values, existingChart) {
  if (existingChart) existingChart.destroy();

  const ctx = document.getElementById(id).getContext("2d");

  // Grey gradient theme
  const gradient = ctx.createLinearGradient(0, 0, 0, 300);
  gradient.addColorStop(0, "rgba(156,163,175,0.45)");
  gradient.addColorStop(1, "rgba(156,163,175,0)");

  return new Chart(ctx, {
    type: "line",
    data: {
      labels: labels,
      datasets: [{
        data: values,
        borderColor: "#9ca3af",
        backgroundColor: gradient,
        fill: true,
        tension: 0.4,
        borderWidth: 3
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: {
        x: { grid: { display: false } },
        y: { grid: { color: "rgba(255,255,255,0.05)" } }
      }
    }
  });
}

// ================= START =================
loadTwitterData();
setInterval(loadTwitterData, 10000);
</script>
</body>
</html>
